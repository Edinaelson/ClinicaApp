@inject ISnackbar Snackbar
@inject Data.ApplicationDbContext Db



<MudDialogContent>
    <MudPaper Class="pa-4" Elevation="0">
        <MudTextField Label="Nome" @bind-Value="PacienteEditado.Nome" Variant="Variant.Filled" Class="my-2" />
        <MudTextField Label="Email" @bind-Value="PacienteEditado.Email" Variant="Variant.Filled" Class="my-2" />
        <MudTextField Mask="@(new PatternMask("(00) 00000-0000"))" Label="phone Number"
                      @bind-Value="PacienteEditado.Telefone" Clearable  Variant="Variant.Filled" Class="my-2"/>
        <MudDatePicker Label="Data de Nascimento" @bind-Date="PacienteEditado.DataNascimento" Variant="Variant.Filled"
                       Class="my-2"
                       DateFormat="dd/MM/yyyy" AdornmentIcon="@Icons.Material.Filled.Event" Adornment="Adornment.End"/>
    </MudPaper>
</MudDialogContent>

<MudDialogActions Class="px-4 pb-4">
    <MudButton OnClick="@(async () => await Salvar())" Color="Color.Primary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save">
        Salvar
    </MudButton>
    <MudButton OnClick="Cancel" Color="Color.Secondary" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Cancel">
        Cancelar
    </MudButton>
</MudDialogActions>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; }
    
    [Parameter] public Cliente Paciente { get; set; }

    private void Submit() => MudDialog.Close(DialogResult.Ok(true));

    private void Cancel() => MudDialog.Cancel();
    
    private Cliente PacienteEditado = new();
    
    protected override void OnInitialized()
    {
        PacienteEditado = new Cliente();
    }

    private async Task Salvar()
    {
        try
        {
            await Db.Clientes.AddAsync(PacienteEditado);
            await Db.SaveChangesAsync();
            Snackbar.Add("Cliente adicionado com sucesso!", Severity.Success, config =>
            {
                config.ShowCloseIcon = true;
                config.VisibleStateDuration = 3000;
            });
            MudDialog.Close(DialogResult.Ok(PacienteEditado));
        }
        catch (Exception ex)
        {
            Snackbar.Add("Erro ao adicionar cliente: " + ex.Message, Severity.Error);
        }
    }
}