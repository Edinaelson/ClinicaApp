@page "/pacientes"
@using Microsoft.EntityFrameworkCore
@inject ClinicApp.Data.ApplicationDbContext Db

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-4">Gerenciamento de Pacientes</MudText>

    <MudPaper Elevation="3" Class="pa-4">
        <MudDataGrid Items="@pacientes" 
                     T="Paciente" 
                     Hover="true"
                     Striped="true"
                     Dense="true">
            <Columns>
                <PropertyColumn Property="x => x.Nome" Title="Nome" />
                <PropertyColumn Property="x => x.Telefone" Title="Telefone" />
                <PropertyColumn Property="x => x.DataNascimento" Title="Data de Nascimento" Format="dd/MM/yyyy" />
            </Columns>
            <PagerContent>
                <MudDataGridPager T="Paciente" />
            </PagerContent>
        </MudDataGrid>
    </MudPaper>
</MudContainer>

@code {
    private List<Paciente> pacientes = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            pacientes = await Db.Pacientes.ToListAsync();
            StateHasChanged();
        }
        catch (Exception ex)
        {
            await Task.Run(() => 
            {
                // Aqui você poderia adicionar um sistema de logging
                Console.WriteLine($"Erro ao carregar pacientes: {ex.Message}");
            });
        }
    }
}